<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Simple Website Health Check</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .metric-card {
            transition: all 0.2s ease;
        }
        .metric-card:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto p-6">
        <!-- Input Section -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Website Health Check</h1>
            <p class="text-gray-600">Simple tool to check how well your website is doing</p>
        </div>

        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <div class="max-w-xl mx-auto">
                <input 
                    type="text" 
                    id="urlInput" 
                    class="w-full p-4 text-lg border rounded-lg mb-4" 
                    placeholder="Enter website URL (e.g., example.com)"
                />
                <button 
                    onclick="analyzeWebsite()" 
                    id="analyzeButton"
                    class="w-full bg-blue-500 text-white px-6 py-4 rounded-lg hover:bg-blue-600 font-semibold transition-colors"
                >
                    Check My Website
                </button>
            </div>

            <!-- Progress Bar -->
            <div id="progressContainer" class="hidden mt-4 max-w-xl mx-auto">
                <div class="w-full bg-gray-200 rounded-full">
                    <div id="progressBar" class="h-2 bg-blue-500 rounded-full" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div id="results" class="hidden space-y-8">
            <!-- Overall Score -->
            <div id="overallScore" class="text-center bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold mb-4">Overall Score</h2>
                <div id="scoreDisplay" class="text-6xl font-bold mb-4"></div>
                <div id="scoreMessage" class="text-gray-600"></div>
            </div>

            <!-- Score Cards -->
            <div id="healthCards" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Performance Score -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-2">Performance</h3>
                    <div id="performanceScore" class="text-3xl font-bold mb-2"></div>
                    <div id="performanceMetrics" class="space-y-2"></div>
                </div>

                <!-- SEO Score -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-2">SEO</h3>
                    <div id="seoScore" class="text-3xl font-bold mb-2"></div>
                    <div id="seoMetrics" class="space-y-2"></div>
                </div>

                <!-- Accessibility Score -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-2">Accessibility</h3>
                    <div id="accessibilityScore" class="text-3xl font-bold mb-2"></div>
                    <div id="accessibilityMetrics" class="space-y-2"></div>
                </div>

                <!-- Design Score -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold mb-2">Design</h3>
                    <div id="designScore" class="text-3xl font-bold mb-2"></div>
                    <div id="designMetrics" class="space-y-2"></div>
                </div>
            </div>

            <!-- Improvement Suggestions -->
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold mb-6">Things You Can Improve</h2>
                <div id="recommendations" class="space-y-4"></div>
            </div>

            <!-- Score Visualization -->
            <div class="bg-white rounded-xl shadow-lg p-8">
                <h2 class="text-2xl font-bold mb-6">Score Breakdown</h2>
                <div class="h-[400px]">
                    <canvas id="radarChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        let radarChart = null;

        // Add Enter key support
        document.getElementById('urlInput').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                analyzeWebsite();
            }
        });

        async function analyzeWebsite() {
            const urlInput = document.getElementById('urlInput');
            const url = urlInput.value.trim();
            
            if (!url) {
                alert('Please enter a website URL');
                return;
            }

            const button = document.getElementById('analyzeButton');
            const progressContainer = document.getElementById('progressContainer');
            const progressBar = document.getElementById('progressBar');
            const results = document.getElementById('results');

            button.disabled = true;
            button.textContent = 'Analyzing...';
            progressContainer.classList.remove('hidden');
            progressBar.style.width = '0%';
            results.classList.add('hidden');

            let progress = 0;
            const incrementProgress = () => {
                if (progress < 90) {
                    progress += Math.floor(Math.random() * 10) + 1;
                    progressBar.style.width = `${Math.min(progress, 90)}%`;
                }
            };
            const progressInterval = setInterval(incrementProgress, 300);

            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ urls: [url] })
                });

                const result = await response.json();

                clearInterval(progressInterval);
                progressBar.style.width = '100%';
                
                if (result.success && result.data.detailed_results[0].success) {
                    displayResults(result.data.detailed_results[0]);
                    results.classList.remove('hidden');
                } else {
                    throw new Error(result.error || 'Analysis failed');
                }
            } catch (error) {
                clearInterval(progressInterval);
                console.error('Error:', error);
                alert('Error analyzing website. Please check the console for details.');
            } finally {
                button.disabled = false;
                button.textContent = 'Check My Website';
                setTimeout(() => progressContainer.classList.add('hidden'), 1000);
            }
        }

        function getScoreColor(score) {
            if (score >= 8) return 'text-green-600';
            if (score >= 6) return 'text-yellow-600';
            return 'text-red-600';
        }

        function getScoreMessage(score) {
            if (score >= 8) return 'Excellent! Your website is performing very well.';
            if (score >= 6) return 'Good, but there\'s room for improvement.';
            return 'Needs attention. We found some important issues.';
        }

        function updateRadarChart(scores) {
            const ctx = document.getElementById('radarChart');
            
            if (radarChart) {
                radarChart.destroy();
            }

            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Performance', 'Design', 'SEO', 'Accessibility'],
                    datasets: [{
                        label: 'Scores',
                        data: [
                            scores.performance_score,
                            scores.design_score,
                            scores.seo_score,
                            scores.accessibility_score
                        ],
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        borderColor: 'rgb(59, 130, 246)',
                        pointBackgroundColor: 'rgb(59, 130, 246)',
                    }]
                },
                options: {
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 10
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function displayResults(data) {
            // Overall Score
            const scoreDisplay = document.getElementById('scoreDisplay');
            const scoreMessage = document.getElementById('scoreMessage');
            const overallScore = data.scores.overall_score;
            
            scoreDisplay.textContent = `${overallScore.toFixed(1)}/10`;
            scoreDisplay.className = `text-6xl font-bold mb-4 ${getScoreColor(overallScore)}`;
            scoreMessage.textContent = getScoreMessage(overallScore);

            // Category Scores
            updateCategoryScore('performance', data.scores.performance_score, data.metrics.performance);
            updateCategoryScore('seo', data.scores.seo_score, data.metrics.seo);
            updateCategoryScore('accessibility', data.scores.accessibility_score, data.metrics.accessibility);
            updateCategoryScore('design', data.scores.design_score, data.metrics.design);

            // Update Radar Chart
            updateRadarChart(data.scores);

            // Update Recommendations
            updateRecommendations(data.metrics);
        }

        function updateCategoryScore(category, score, metrics) {
            const scoreElement = document.getElementById(`${category}Score`);
            const metricsContainer = document.getElementById(`${category}Metrics`);
            
            scoreElement.textContent = `${score.toFixed(1)}/10`;
            scoreElement.className = `text-3xl font-bold mb-2 ${getScoreColor(score)}`;
            
            metricsContainer.innerHTML = Object.entries(metrics)
                .map(([metric, value]) => `
                    <div class="flex justify-between items-center text-sm">
                        <span class="text-gray-600">${metric.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}</span>
                        <span class="${getScoreColor(value)}">${value.toFixed(1)}</span>
                    </div>
                `).join('');
        }

        function updateRecommendations(metrics) {
            const container = document.getElementById('recommendations');
            container.innerHTML = '';
            let hasRecommendations = false;

            for (const [category, categoryMetrics] of Object.entries(metrics)) {
                for (const [metric, score] of Object.entries(categoryMetrics)) {
                    if (score < 7) {
                        hasRecommendations = true;
                        const recommendation = document.createElement('div');
                        recommendation.className = 'bg-white p-4 rounded-lg border-l-4 border-blue-500 shadow-sm';
                        
                        let recommendationText = '';
                        switch(metric) {
                            case 'load_time':
                                recommendationText = 'Optimize page load time through compression and caching';
                                break;
                            case 'response_size':
                                recommendationText = 'Reduce page size by optimizing images and minifying resources';
                                break;
                            case 'color_contrast':
                                recommendationText = 'Improve color contrast for better accessibility';
                                break;
                            case 'typography':
                                recommendationText = 'Review typography hierarchy and font usage';
                                break;
                            case 'responsive_design':
                                recommendationText = 'Enhance mobile responsiveness and viewport settings';
                                break;
                            case 'meta_description':
                                recommendationText = 'Add meta description for better SEO';
                                break;
                            case 'headings':
                                recommendationText = 'Improve heading structure for better SEO and accessibility';
                                break;
                            case 'img_alt':
                                recommendationText = 'Add alt text to images for accessibility';
                                break;
                            case 'form_labels':
                                recommendationText = 'Ensure all form fields have proper labels';
                                break;
                            default:
                                recommendationText = `Consider improving ${metric.replace(/_/g, ' ')}`;
                        }

                        recommendation.innerHTML = `
                            <div class="flex justify-between items-start">
                                <div>
                                    <h3 class="font-semibold capitalize">${category}: ${metric.replace(/_/g, ' ')}</h3>
                                    <p class="text-gray-600 mt-1">${recommendationText}</p>
                                </div>
                                <div class="font-bold ${getScoreColor(score)}">
                                    ${score.toFixed(1)}/10
                                </div>
                            </div>
                        `;
                        container.appendChild(recommendation);
                    }
                }
            }

            if (!hasRecommendations) {
                container.innerHTML = `
                    <div class="bg-green-50 p-4 rounded-lg">
                        <p class="text-green-600">Great job! Your website is performing well in all areas.</p>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>
